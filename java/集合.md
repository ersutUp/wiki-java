# <div id="set"></div>é›†åˆ

## List



### <span id="arraylist"></span>ArrayList

[åŸç†å±•ç¤º](./html/arraylist-visualization-single-demo.html)

åˆå§‹å¤§å°ï¼š10

æ¯æ¬¡æ‰©å®¹1.5å€



### <span id="linkedlist"></span>LinkedList



å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨



| åœºæ™¯                 | ArrayList ä¼˜åŠ¿       | LinkedList ä¼˜åŠ¿                 |
| -------------------- | -------------------- | ------------------------------- |
| éšæœºè®¿é—®ï¼ˆ`get(i)`ï¼‰ | O (1)ï¼Œé«˜æ•ˆ          | O (n)ï¼Œä½æ•ˆ                     |
| ä¸­é—´æ’å…¥ / åˆ é™¤      | O (n)ï¼ˆéœ€ç§»åŠ¨å…ƒç´ ï¼‰  | è‹¥å·²çŸ¥èŠ‚ç‚¹ï¼ŒO (1)ï¼ˆä»…ä¿®æ”¹æŒ‡é’ˆï¼‰ |
| å°¾éƒ¨æ’å…¥ / åˆ é™¤      | O (1)ï¼ˆæ— æ‰©å®¹æ—¶ï¼‰    | O(1)                            |
| å†…å­˜å ç”¨             | è¿ç»­ç©ºé—´ï¼Œå¯èƒ½æœ‰å†—ä½™ | åˆ†æ•£ç©ºé—´ï¼Œæ¯ä¸ªå…ƒç´ é¢å¤–æŒ‡é’ˆå¼€é”€  |
| éå†æ•ˆç‡             | é«˜ï¼ˆç¼“å­˜å‹å¥½ï¼‰       | ä½ï¼ˆç¼“å­˜ä¸å‹å¥½ï¼‰                |

## Map

ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹



### <span id='HashMap' />HashMap

- HashMapçš„å¤§å°ï¼ˆsizeå˜é‡ï¼‰ï¼škey â†’ value çš„ä¸ªæ•°
- åº•å±‚çš„æ•°æ®å­˜å‚¨ï¼ˆtableå˜é‡ï¼‰ï¼š
  - ä»–æ˜¯ä¸ªæ•°ç»„`Node<K,V>[] table`
  - é»˜è®¤å®¹é‡æ˜¯16ï¼ˆè¿™ä¸ªå®¹é‡ä¸æ˜¯Mapçš„å¤§å°ï¼Œæ˜¯åº•å±‚å­˜å‚¨æ•°æ®çš„æ•°ç»„ï¼‰
  - è¿™ä¸ªæ•°ç»„çš„ç±»å‹ä¸º`Node`å¯¹è±¡
  - **ğŸ’¡æ³¨æ„å®¹é‡ä¸€å®šæ˜¯2çš„å¹‚**
- åŠ è½½å› å­ï¼ˆloadFactorå˜é‡ï¼‰ï¼š
  - é»˜è®¤0.75ï¼ˆDEFAULT_LOAD_FACTORå¸¸é‡ï¼‰
  - å½“å®¹é‡è¶…å‡º `size*loadFactor` é‚£ä¹ˆå°±å¼€å§‹æ‰©å®¹ï¼Œå³å¢åŠ tableæ•°ç»„çš„é•¿åº¦

#### è®¡ç®—keyå¯¹åº”çš„ç´¢å¼•

> [ç½‘é¡µæ¼”ç¤º](./html/hashmap-animation-fixed.html)

1. é€šè¿‡è®¡ç®—keyçš„hashCodeå€¼ `key.hashCode()`
2. å¯¹hashCodeå€¼å†æ¬¡å¤„ç†å‡å°‘å…¶å†²çªçš„æ¦‚ç‡å¾—åˆ°hashå€¼ `int hash = hashCode^(hashCode >>> 16)`
3. ç”¨ hashå€¼ ä¸ å®¹é‡ è®¡ç®—è·å–ç´¢å¼•å€¼ `int index = hash & (table.length - 1);`

##### **è®¡ç®—ç´¢å¼•çš„æºç **

**å…¬å¼ï¼š`int index = (table.length - 1) & hash;`**

##### ğŸ’¡ä¸ºä»€ä¹ˆéœ€è¦`table.length - 1`

å­˜å‚¨æ•°æ®çš„ `table` å˜é‡çš„å¤§å°ï¼Œåˆå§‹å€¼æ˜¯16ï¼Œæ¯æ¬¡æ‰©å®¹æ—¶ï¼Œä¼šå¢åŠ ä¸€å€ï¼Œå³ 32ã€64ã€128ã€256ã€512...... ä»¥æ­¤ç±»æ¨

æ‰€ä»¥ `table` çš„å¤§å°ä¸€å®šæ˜¯ **2çš„å¹‚** 

è½¬æ¢ä¸º2è¿›åˆ¶å°±æ˜¯

| åè¿›åˆ¶ | äºŒè¿›åˆ¶    |
| ------ | --------- |
| 160    | 0001 0000 |
| 32     | 0010 0000 |
| 64     | 0100 0000 |
| 128    | 1000 0000 |

ç»§ç»­çœ‹å…¬å¼`table.length - 1` 

å…¶äºŒè¿›åˆ¶çš„å€¼ä¼šå˜ä¸º

| åè¿›åˆ¶    | äºŒè¿›åˆ¶    |
| --------- | --------- |
| 16-1=15   | 0000 1111 |
| 32-1=31   | 0001 1111 |
| 64-1=63   | 0011 1111 |
| 128-1=127 | 0111 1111 |

`&`è¿ç®— 

- 1å’Œ1ä¸º1
- 0å’Œ0ä¸º0
- 0å’Œ1ä¸º0
- 1å’Œ0ä¸º0

é‚£ä¹ˆä¸ç®¡hashå€¼å¤šå¤§ï¼Œé«˜ä½ï¼ˆè¿™é‡ŒæŒ‡çš„`table.length - 1`åœ¨äºŒè¿›åˆ¶ä¸­çš„0 ï¼‰çš„éƒ½ä¼šæ¸…é›¶ï¼Œè¿™æ ·ç®—å‡ºçš„ç»“æœä¸€å®šä¸ä¼šè¶…å‡º`table`çš„é•¿åº¦ï¼Œç¤ºä¾‹å¦‚ä¸‹

|                              | åè¿›åˆ¶  | äºŒè¿›åˆ¶    |
| ---------------------------- | ------- | --------- |
| `table`çš„é•¿åº¦                | 16-1=15 | 0000 1111 |
| å¤„ç†åçš„hashå€¼               |         | 1011 1001 |
| æˆ–(`&`)è¿ç®—ç»“æœ,ä¹Ÿå°±æ˜¯ç´¢å¼•å€¼ | 9       | 0000 1001 |

ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ä¸­ç´¢å¼•å®šä½åˆ° 9

å†æ¥ä¸€ä¸ª

|                              | åè¿›åˆ¶    | äºŒè¿›åˆ¶              |
| ---------------------------- | --------- | ------------------- |
| `table`çš„é•¿åº¦                | 512-1=511 | 0000 0001 1111 1111 |
| å¤„ç†åçš„hashå€¼               |           | 1011 0011 1111 0111 |
| æˆ–(`&`)è¿ç®—ç»“æœ,ä¹Ÿå°±æ˜¯ç´¢å¼•å€¼ | 503       | 0000 0001 1111 0111 |

ä¸Šè¾¹è¿™ä¸ªç¤ºä¾‹ä¸­ç´¢å¼•å®šä½åˆ° 503



ç»¼ä¸Šæ‰€è¿°ï¼Œ**è®¡ç®—åçš„å€¼æ˜¯ä¸ä¼šè¶Šç•Œçš„**

#### æ‰©å®¹

> é’ˆå¯¹åº•å±‚tableå˜é‡ï¼ˆå­˜å‚¨keyã€valueçš„æ•°ç»„ï¼‰çš„æ‰©å®¹
>
> [ç½‘é¡µæ¼”ç¤º](./html/hashmap-resize-complete.html)

##### ç›¸å…³å˜é‡

- `size`ï¼šHashMapçš„å¤§å°ï¼Œå³å­˜å‚¨äº†å¤šå°‘ä¸ªkeyã€value
-  `threshold` ï¼šæ‰©å®¹çš„é˜ˆå€¼
- `loadFactor`ï¼šè®¡ç®—å› å­ï¼Œç”¨æ¥è®¡ç®—æ‰©å®¹çš„é˜ˆå€¼
- `table`ï¼šåº•å±‚å­˜å‚¨æ•°æ®çš„æ•°ç»„

thresholdé˜ˆå€¼çš„è®¡ç®— `table.length*loadFactor`ï¼Œåˆå§‹å€¼(æœªæŒ‡å®šå®¹é‡å’ŒåŠ è½½å› å­çš„æƒ…å†µä¸‹)ä¸º `16*0.75`

**åœ¨HashMapçš„å¤§å°(sizeå˜é‡) å¤§äºç­‰äº threshold æ—¶è¿›è¡Œæ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹åŸæ¥å®¹é‡(`tableçš„é•¿åº¦`)çš„2å€ã€‚**



##### æ‰©å®¹çš„æµç¨‹

1. åˆ›å»ºæ–°çš„tableï¼Œé•¿åº¦ä¸ºåŸæ¥çš„2å€
2. è®¡ç®—åŸtableä¸­æ‰€æœ‰å…ƒç´ çš„åœ¨æ–°tableä¸­çš„æ–°ç´¢å¼•



##### <span id="newIndex"></span>â­ï¸æ–°ç´¢å¼•çš„è®¡ç®—

æ–°ç´¢å¼•çš„è®¡ç®—æ— éœ€é‡æ–°ï¼Œå› ä¸ºå…ƒç´ çš„æ–°ç´¢å¼•åªæœ‰ä¸¤ç§å¯èƒ½ï¼š**ä¸æ—§ç´¢å¼•ç›¸åŒ**ï¼Œæˆ– **æ—§ç´¢å¼• + æ—§å®¹é‡**ï¼ˆå–å†³äºå“ˆå¸Œå€¼çš„é«˜ä½æ˜¯å¦ä¸º 1ï¼‰ã€‚

**æ—§ç´¢å¼• + æ—§å®¹é‡çš„æƒ…å†µ**

| å®¹é‡                 | hashå€¼ | è®¡ç®—ç´¢å¼•å€¼ hash & (table.length - 1) | æ‰©å®¹æ—¶è®¡ç®—ç´¢å¼•  oldIndex + oldCap |
| -------------------- | ------ | ------------------------------------ | --------------------------------- |
| oldCap(æ—§å®¹é‡)ï¼š0100 | 0110   | 0110 & 0011 = 0010                   |                                   |
| newCap(æ–°å®¹é‡)ï¼š1000 | åŒä¸Š   | 0110 & 0111 = 0110                   | 0100 +  0010 = 0110               |



**ä¸æ—§ç´¢å¼•ç›¸åŒçš„æƒ…å†µ**

| å®¹é‡                 | hashå€¼ | è®¡ç®—ç´¢å¼•å€¼ hash & (table.length - 1) | æ‰©å®¹æ—¶è®¡ç®—ç´¢å¼•ï¼ˆä¸æ—§ç´¢å¼•ç›¸åŒï¼‰ |
| -------------------- | ------ | ------------------------------------ | ------------------------------ |
| oldCap(æ—§å®¹é‡)ï¼š0100 | 0010   | 0010 & 0011 = 0010                   |                                |
| newCap(æ–°å®¹é‡)ï¼š1000 | åŒä¸Š   | 0010 & 0111 = 0010                   | 0010                           |



**å¦‚ä½•ç”¨ä»£ç åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ**

é€šè¿‡ æ—§å®¹é‡å’Œhashå€¼åš & è¿ç®—  `hash & oldCap` ç­‰äº0 ï¼Œåˆ™ç´¢å¼•ä½ç½®ä¸å˜ï¼Œå¦åˆ™æ–°ç´¢å¼•ä¸º æ—§ç´¢å¼• + æ—§å®¹é‡

ç®€æ˜“ç¤ºä¾‹ä»£ç 

```java
// æ–°ç´¢å¼•åªæœ‰ä¸¤ç§å¯èƒ½ï¼š
int hash = node.hash;
int oldCap = 16;
if ((hash & oldCap) == 0) {
    æ–°ç´¢å¼• = æ—§ç´¢å¼•;
} else {
    æ–°ç´¢å¼• = æ—§ç´¢å¼• + oldCap;  // æ—§å®¹é‡
}
```



##### <span id="hashmap_2"/>ğŸ’¡ä¸ºä»€ä¹ˆéœ€è¦æ‰©å®¹2å€

1. åœ¨è®¡ç®—ç´¢å¼•æ—¶ ä½¿ç”¨hashç  æ¥è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå…¬å¼ä¸º`hash & (table.length - 1)`ï¼Œå…¶ä¸­`table.length - 1`çš„2è¿›åˆ¶ä¸­éƒ½ä¸º1ï¼Œç”¨ & è®¡ç®—å¯ä»¥**æé«˜æ¡¶çš„å‡åŒ€åˆ†å¸ƒ**
2. æ‰©å®¹æ—¶ é‡æ–°è®¡ç®—ç´¢å¼• å¯ä»¥æå‡æ•ˆç‡ï¼Œå…·ä½“çœ‹[ä¸Šè¾¹](#newIndex)



##### æ‰©å®¹æ—¶çº¢é»‘æ ‘é™çº§å›é“¾è¡¨æƒ…å†µ

å½“é“¾è¡¨å¤§äº8ä¸ªæ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼›

é‚£**æ‰©å®¹æ—¶ä¼šé‡æ–°è®¡ç®—ç´¢å¼•ï¼Œæ‰€ä»¥çº¢é»‘æ ‘ä¸Šçš„å¯èƒ½ä¸è¶³8ä¸ªï¼Œ å½“å°äº6ä¸ªæ—¶ä¼šé™çº§å›é“¾è¡¨**ã€‚



### <span  id="LinkedHashMap" />LinkedHashMap

ç»§æ‰¿è‡ªHashMap`public class LinkedHashMap<K,V> extends HashMap<K,V> implements Map<K,V>`

åœ¨HashMapçš„åŸºç¡€ä¸Šç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨

æ ¸å¿ƒä»£ç 

```java
//é“¾è¡¨çš„å¤´
transient LinkedHashMap.Entry<K,V> head;
//é“¾è¡¨çš„å°¾
transient LinkedHashMap.Entry<K,V> tail;

// HashMap.Node æ˜¯çœŸæ­£å­˜å‚¨æ•°æ®çš„å¯¹è±¡
static class Entry<K,V> extends HashMap.Node<K,V> {
    //å¢åŠ é“¾è¡¨çš„æŒ‡é’ˆ
    Entry<K,V> before, after;
    Entry(int hash, K key, V value, Node<K,V> next) {
        super(hash, key, value, next);
    }
}
//åˆ›å»ºnodeå¯¹è±¡
Node<K,V> newNode(int hash, K key, V value, Node<K,V> e) {
    LinkedHashMap.Entry<K,V> p =
        new LinkedHashMap.Entry<K,V>(hash, key, value, e);
    linkNodeLast(p);
    return p;
}
//æ·»åŠ é“¾è¡¨çš„æŒ‡é’ˆ
private void linkNodeLast(LinkedHashMap.Entry<K,V> p) {
    LinkedHashMap.Entry<K,V> last = tail;
    tail = p;
    if (last == null)
        head = p;
    else {
        p.before = last;
        last.after = p;
    }
}
```

**`newNode`æ–¹æ³•ï¼š`put`æ–¹æ³•æœ€ç»ˆé€šè¿‡è°ƒç”¨`newNode`æ–¹æ³•å­˜å‚¨çš„æ•°æ®ï¼Œæ‰€ä»¥`LinkedHashMap`é‡å†™äº†`newNode`æ–¹æ³•**

